<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
     
     <script async src="https://www.googletagmanager.com/gtag/js?id=G-K1PWW3YCPK"></script>
     <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
 
     gtag('config', 'G-K1PWW3YCPK');
     </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16.png">
    <link rel="manifest" href="../../images/site.webmanifest">
    
    <link href="../../css/style.css" rel="stylesheet" media="all">
    <link href="../../css/syntax.css" rel="stylesheet" media="all">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>
      
    </title>

    <meta property="og:locale" content="en_GB" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="" />
    <meta property="og:image" content="https://puneet.uk/images/.jpg" />
    <meta property="article:tag" content="Technical blog" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:image" content="https://puneet.uk/images/.jpg" />
 
  </head>
  <body>
    <header>     
        <nav role="navigation">
            <div class="container">                            
                <div class="f-left">
    <h1>
        <a href="../../index.html" class="home">Paul Singh</a>
             
       
    </h1>
    <span class="desktop-bar">|</span>
    
    
    <span id="linkedin-follow-button">
        <a href="https://www.linkedin.com/in/puneetthukral" target="_blank">Follow me on LinkedIn</a>
    </span>
</div>  
                <nav aria-label="Victoria.dev main menu" id="custom-menu">
    <button class="custom-menu-toggle" aria-label="Toggle menu">
        <a role="menuitem" href="#"><img src="../../images/menu.svg" alt="menu icon" class="menu-icon"></a>
    </button>
    <ul role="menubar" class="custom-menu">
        
        <li role="none" class="custom-menu-item">
            <a role="menuitem" href="../../notes/notes/">
                <img src="../../images/notes.svg" alt="Notes icon" class="custom-filter-icon"> Notes
            </a>
        </li>
        
        <li role="none" class="custom-menu-item">
            <a role="menuitem" href="../../code/code/">
                <img src="../../images/code.svg" alt="Code icon" class="custom-filter-icon"> Code
            </a>
        </li>
        
        <li role="none" class="custom-menu-item">
            <a role="menuitem" href="../../read/bookshelf_home/">
                <img src="../../images/bookshelf.svg" alt="Bookshelf icon" class="custom-filter-icon"> Bookshelf
            </a>
        </li>
        
    </ul>
</nav>
    
              </div>           
          </nav>
      </header>
            </div>           
        </nav>
    </header>
    
      <div class="wrap">
        <main class="container">
          <h1></h1>
<p></p>





<time>Updated on: Nov 14, 2024</time>






         
          <div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Import the required libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">yfinance</span> <span style="color:#6ab825;font-weight:bold">as</span> <span style="color:#447fcf;text-decoration:underline">yf</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">pandas</span> <span style="color:#6ab825;font-weight:bold">as</span> <span style="color:#447fcf;text-decoration:underline">pd</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">numpy</span> <span style="color:#6ab825;font-weight:bold">as</span> <span style="color:#447fcf;text-decoration:underline">np</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">matplotlib.pyplot</span> <span style="color:#6ab825;font-weight:bold">as</span> <span style="color:#447fcf;text-decoration:underline">plt</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Step 1: Define the stock and download the data</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># You can change &#39;AAPL&#39; to any other stock ticker symbol</span>
</span></span><span style="display:flex;"><span>stock_ticker = <span style="color:#ed9d13">&#39;AAPL&#39;</span>
</span></span><span style="display:flex;"><span>start_date = <span style="color:#ed9d13">&#39;2020-01-01&#39;</span>
</span></span><span style="display:flex;"><span>end_date = <span style="color:#ed9d13">&#39;2023-01-01&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Download stock data from Yahoo Finance</span>
</span></span><span style="display:flex;"><span>stock_data = yf.download(stock_ticker, start=start_date, end=end_date)
</span></span></code></pre></div><pre><code>[*********************100%***********************]  1 of 1 completed
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Display the first few rows of the data to ensure it&#39;s been downloaded correctly</span>
</span></span><span style="display:flex;"><span><span style="color:#24909d">print</span>(stock_data.head())
</span></span></code></pre></div><pre><code>                 Open       High        Low      Close  Adj Close     Volume
Date                                                                        
2020-01-02  74.059998  75.150002  73.797501  75.087502  72.876114  135480400
2020-01-03  74.287498  75.144997  74.125000  74.357498  72.167603  146322800
2020-01-06  73.447502  74.989998  73.187500  74.949997  72.742661  118387200
2020-01-07  74.959999  75.224998  74.370003  74.597504  72.400558  108872000
2020-01-08  74.290001  76.110001  74.290001  75.797501  73.565193  132079200
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Step 2: Calculate Moving Averages</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Define the window sizes for moving averages (you can customize these)</span>
</span></span><span style="display:flex;"><span>short_window = <span style="color:#3677a9">20</span>  <span style="color:#999;font-style:italic"># 20-day moving average</span>
</span></span><span style="display:flex;"><span>long_window = <span style="color:#3677a9">50</span>   <span style="color:#999;font-style:italic"># 50-day moving average</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Calculate short-term moving average (20 days)</span>
</span></span><span style="display:flex;"><span>stock_data[<span style="color:#ed9d13">&#39;MA20&#39;</span>] = stock_data[<span style="color:#ed9d13">&#39;Close&#39;</span>].rolling(window=short_window).mean()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Calculate long-term moving average (50 days)</span>
</span></span><span style="display:flex;"><span>stock_data[<span style="color:#ed9d13">&#39;MA50&#39;</span>] = stock_data[<span style="color:#ed9d13">&#39;Close&#39;</span>].rolling(window=long_window).mean()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Display the first few rows with the moving averages added</span>
</span></span><span style="display:flex;"><span><span style="color:#24909d">print</span>(stock_data[[<span style="color:#ed9d13">&#39;Close&#39;</span>, <span style="color:#ed9d13">&#39;MA20&#39;</span>, <span style="color:#ed9d13">&#39;MA50&#39;</span>]].head())
</span></span></code></pre></div><pre><code>                Close  MA20  MA50
Date                             
2020-01-02  75.087502   NaN   NaN
2020-01-03  74.357498   NaN   NaN
2020-01-06  74.949997   NaN   NaN
2020-01-07  74.597504   NaN   NaN
2020-01-08  75.797501   NaN   NaN
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Step 3: Plot the stock price and moving averages</span>
</span></span><span style="display:flex;"><span>plt.figure(figsize=(<span style="color:#3677a9">14</span>, <span style="color:#3677a9">7</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Plot the closing price</span>
</span></span><span style="display:flex;"><span>plt.plot(stock_data[<span style="color:#ed9d13">&#39;Close&#39;</span>], label=<span style="color:#ed9d13">f</span><span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">{</span>stock_ticker<span style="color:#ed9d13">}</span><span style="color:#ed9d13"> Close Price&#39;</span>, color=<span style="color:#ed9d13">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Plot the short-term moving average</span>
</span></span><span style="display:flex;"><span>plt.plot(stock_data[<span style="color:#ed9d13">&#39;MA20&#39;</span>], label=<span style="color:#ed9d13">&#39;20-Day Moving Average&#39;</span>, color=<span style="color:#ed9d13">&#39;red&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Plot the long-term moving average</span>
</span></span><span style="display:flex;"><span>plt.plot(stock_data[<span style="color:#ed9d13">&#39;MA50&#39;</span>], label=<span style="color:#ed9d13">&#39;50-Day Moving Average&#39;</span>, color=<span style="color:#ed9d13">&#39;green&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Adding title and labels</span>
</span></span><span style="display:flex;"><span>plt.title(<span style="color:#ed9d13">f</span><span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">{</span>stock_ticker<span style="color:#ed9d13">}</span><span style="color:#ed9d13"> Price and Moving Averages&#39;</span>)
</span></span><span style="display:flex;"><span>plt.xlabel(<span style="color:#ed9d13">&#39;Date&#39;</span>)
</span></span><span style="display:flex;"><span>plt.ylabel(<span style="color:#ed9d13">&#39;Price (USD)&#39;</span>)
</span></span><span style="display:flex;"><span>plt.legend()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Show the plot</span>
</span></span><span style="display:flex;"><span>plt.show()
</span></span></code></pre></div><p><img src="moving_average_analysis_files/moving_average_analysis_6_0.png" alt="png"></p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Step 4: Add buy/sell signals (optional)</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># We can add a simple strategy where we buy when the short MA crosses above the long MA and sell when it crosses below</span>
</span></span><span style="display:flex;"><span>stock_data[<span style="color:#ed9d13">&#39;Signal&#39;</span>] = <span style="color:#3677a9">0</span>  <span style="color:#999;font-style:italic"># Initialize signal column</span>
</span></span><span style="display:flex;"><span>stock_data[<span style="color:#ed9d13">&#39;Signal&#39;</span>][short_window:] = np.where(stock_data[<span style="color:#ed9d13">&#39;MA20&#39;</span>][short_window:] &gt; stock_data[<span style="color:#ed9d13">&#39;MA50&#39;</span>][short_window:], <span style="color:#3677a9">1</span>, -<span style="color:#3677a9">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Generate trading orders</span>
</span></span><span style="display:flex;"><span>stock_data[<span style="color:#ed9d13">&#39;Position&#39;</span>] = stock_data[<span style="color:#ed9d13">&#39;Signal&#39;</span>].diff()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Display the trading signals</span>
</span></span><span style="display:flex;"><span><span style="color:#24909d">print</span>(stock_data[[<span style="color:#ed9d13">&#39;Close&#39;</span>, <span style="color:#ed9d13">&#39;MA20&#39;</span>, <span style="color:#ed9d13">&#39;MA50&#39;</span>, <span style="color:#ed9d13">&#39;Signal&#39;</span>, <span style="color:#ed9d13">&#39;Position&#39;</span>]].tail())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Plot the buy/sell signals on the stock price chart</span>
</span></span><span style="display:flex;"><span>plt.figure(figsize=(<span style="color:#3677a9">14</span>, <span style="color:#3677a9">7</span>))
</span></span><span style="display:flex;"><span>plt.plot(stock_data[<span style="color:#ed9d13">&#39;Close&#39;</span>], label=<span style="color:#ed9d13">f</span><span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">{</span>stock_ticker<span style="color:#ed9d13">}</span><span style="color:#ed9d13"> Close Price&#39;</span>, color=<span style="color:#ed9d13">&#39;blue&#39;</span>)
</span></span><span style="display:flex;"><span>plt.plot(stock_data[<span style="color:#ed9d13">&#39;MA20&#39;</span>], label=<span style="color:#ed9d13">&#39;20-Day Moving Average&#39;</span>, color=<span style="color:#ed9d13">&#39;red&#39;</span>)
</span></span><span style="display:flex;"><span>plt.plot(stock_data[<span style="color:#ed9d13">&#39;MA50&#39;</span>], label=<span style="color:#ed9d13">&#39;50-Day Moving Average&#39;</span>, color=<span style="color:#ed9d13">&#39;green&#39;</span>)
</span></span></code></pre></div><pre><code>                 Close      MA20        MA50  Signal  Position
Date                                                          
2022-12-23  131.860001  140.6610  144.131800      -1       0.0
2022-12-27  130.029999  139.9515  143.964799      -1       0.0
2022-12-28  126.040001  139.1950  143.637399      -1       0.0
2022-12-29  129.610001  138.2740  143.354599      -1       0.0
2022-12-30  129.929993  137.3550  143.075999      -1       0.0


C:\Users\pthuk\AppData\Local\Temp\ipykernel_12716\886034155.py:4: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df[&quot;col&quot;][row_indexer] = value

Use `df.loc[row_indexer, &quot;col&quot;] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  stock_data['Signal'][short_window:] = np.where(stock_data['MA20'][short_window:] &gt; stock_data['MA50'][short_window:], 1, -1)
C:\Users\pthuk\AppData\Local\Temp\ipykernel_12716\886034155.py:4: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  stock_data['Signal'][short_window:] = np.where(stock_data['MA20'][short_window:] &gt; stock_data['MA50'][short_window:], 1, -1)





[&lt;matplotlib.lines.Line2D at 0x23371519940&gt;]
</code></pre>
<p><img src="moving_average_analysis_files/moving_average_analysis_7_3.png" alt="png"></p>

          

<div class="alert alert-thoughts" role="alert" id="bug"> 
</div>
<script>
    
    var current_page = document.location.href;
    var _title =  document.title;   
    
    var _url = 'https://github.com/MrSingh/notes/issues/new?body=' + current_page;
    var bug_snippet = "<i class='material-icons'>bug_report</i>Report an error or bug <a href=" + _url + " target='blank'>&nbsp;here</a>.</li>"
    function ready() {
        document.getElementById("bug").innerHTML += bug_snippet;    
    }
    document.addEventListener("DOMContentLoaded", ready);    
</script>

  
      </main>
      </div>
    
    


<footer class="site-footer">
    <div class="container">
        <div class="footer-content">
            <div>&copy; 2025 Puneet (Paul) Singh Thukral</div>
            <div>Site last updated: June 2025</div>
                    
        </div>
    </div>
</footer>




     
     <script
     src="https://code.jquery.com/jquery-3.7.1.min.js"
     integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
     crossorigin="anonymous">
    </script>
    <script src="../../js/utility.js"></script>
     
  </body>
</html>